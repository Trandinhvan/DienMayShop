CREATE DATABASE DA_CNPM_FINAL
GO
USE DA_CNPM_FINAL
GO

CREATE TABLE TAIKHOAN
(
	TenDangNhap nvarchar(50),
	MatKhau nvarchar(50),
	Quyen int,
	primary key(TenDangNhap),
)
ALTER TABLE TAIKHOAN ADD CONSTRAINT FK_TK FOREIGN KEY(Quyen) REFERENCES QUYENDN(ID_Quyen)
CREATE TABLE QUYENDN
(
	ID_Quyen int,
	TenQuyen nvarchar(50),
	primary key(ID_Quyen),
)
CREATE TABLE NHACUNGCAP
(
	MaNCC char(50) Not Null,
	TenNCC nvarchar(50),
	DiaChi nvarchar(50),
	SDt char(11),
	CONSTRAINT PK_NCC PRIMARY KEY(MaNCC),
)

CREATE TABLE LOAISANPHAM
(
	MaLoai char(50) Not null,
	TenLoai nvarchar(50),
	CONSTRAINT PK_LSP PRIMARY KEY(MaLoai),
)


CREATE TABLE SANPHAM
(
	MaSanPham char(50) Not null,
	TenSanPham nvarchar(50),
	MaLoai char(50),
	MaNCC char(50),
	DVT nvarchar(50),
	GIA int,
	constraint pk_SP PRIMARY KEY(MaSanPham),
)
ALTER TABLE SANPHAM ADD CONSTRAINT FK_SP_LSP FOREIGN KEY(MaLoai) REFERENCES LOAISANPHAM(MaLoai)
ALTER TABLE SANPHAM ADD CONSTRAINT FK_SP_NCC FOREIGN KEY(MaNCC) REFERENCES NHACUNGCAP(MaNCC)

CREATE TABLE KHACHHANG
(
	MAKH CHAR(50) NOT NULL,
	TENKH NVARCHAR(50),
	DCHI NVARCHAR(50),
	LinkHinh NVARCHAR(150),
	CONSTRAINT PK_KH PRIMARY KEY(MAKH),
)

CREATE TABLE NHANVIEN
(
	MANV CHAR(10),
	TENNV NVARCHAR(50),
	NGAYSINH DATETIME,
	SDT CHAR(11),
	DCHI NVARCHAR(50),
	CONSTRAINT PK_NV PRIMARY KEY(MANV),
)
CREATE TABLE TAIKHOANTHANHVIEN
(
	SOTHE CHAR(10),
	MANV CHAR(10),
	MAKH CHAR(50),
	NGAYCAP DATETIME,
	CONSTRAINT PK_TKTV PRIMARY KEY(SOTHE),
)
ALTER TABLE TAIKHOANTHANHVIEN ADD CONSTRAINT FK_TKTV_NV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE TAIKHOANTHANHVIEN ADD CONSTRAINT FK_TKTV_KH FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)

CREATE TABLE HOADON
(
	MAHD Nvarchar(50),
	MANV CHAR(10),
	NGAYHD DATETIME,
	MAKH CHAR(50),
	TONGTIEN float,
	CONSTRAINT PK_HD PRIMARY KEY(MAHD),
)
ALTER TABLE HOADON ADD CONSTRAINT FK_HD_NV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
CREATE TABLE CHITIETHD
(
	MAHD Nvarchar(50),
	MASANPHAM CHAR(50) NOT NULL,
	SOLUONG INT,
	DONGIA INT,
	THANHTIEN float,
	TGBH NCHAR(50),
	CONSTRAINT PK_CTHD PRIMARY KEY(MAHD,MASANPHAM),
)
ALTER TABLE CHITIETHD ADD CONSTRAINT FK_CTHD_HD FOREIGN KEY(MAHD) REFERENCES HOADON(MAHD)
ALTER TABLE CHITIETHD ADD CONSTRAINT FK_CTHD_SP FOREIGN KEY(MASANPHAM) REFERENCES SANPHAM(MaSanPham)

CREATE TABLE HOADONNHAPHANG
(
	MaHDNhap char(10),
	NgayLap DateTime,
	TongTien int,
	CONSTRAINT PK_HDNH PRIMARY KEY(MaHDNhap),
)
CREATE TABLE PHIEUBAOHANH
(
	MAPBH char(10),
	MANV CHAR(10),
	MAKH CHAR(50),
	NGAYLAP DateTime,
	TONGTIEN int,
	CONSTRAINT PK_PBH PRIMARY KEY(MAPBH),
)
ALTER TABLE PHIEUBAOHANH ADD CONSTRAINT FK_PBH_NV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
CREATE TABLE CHITIETPHIEUBAOHANH
(
	MAPBH char(10),
	MAHD Nvarchar(50),
	MaSanPham CHAR(50),
	TINHTRANG NVARCHAR(50),
	DONGIA FLOAT,
	SOLUONG INT,
	THANHTIEN FLOAT
	CONSTRAINT PK_CTPBH PRIMARY KEY(MAPBH,MAHD,MaSanPham),
)
ALTER TABLE CHITIETPHIEUBAOHANH ADD CONSTRAINT FK_CTPBH_PBH FOREIGN KEY(MAPBH) REFERENCES PHIEUBAOHANH(MAPBH)
ALTER TABLE CHITIETPHIEUBAOHANH ADD CONSTRAINT FK_CTPBH_HD FOREIGN KEY(MAHD) REFERENCES HOADON(MAHD)
ALTER TABLE CHITIETPHIEUBAOHANH ADD CONSTRAINT FK_CTPBH_SP FOREIGN KEY(MaSanPham) REFERENCES SANPHAM(MaSanPham)


CREATE TABLE CHITIETPHIEUNHAP
(
	MaHDNhap char(10),
	MaSP char(50),
	SoLuong int,
	DonGiaNhap float,
	CONSTRAINT PK_CTPN PRIMARY KEY(MaHDNhap,MaSP),
)


ALTER TABLE CHITIETPHIEUNHAP ADD CONSTRAINT FK_CTPN_PN FOREIGN KEY(MaHDNhap) REFERENCES HOADONNHAPHANG(MaHDNhap)
ALTER TABLE CHITIETPHIEUNHAP ADD CONSTRAINT FK_CTPN_SP FOREIGN KEY(MaSP) REFERENCES SANPHAM(MaSanPham)

CREATE TABLE PHIEUGIAOHANG
(
	MaPhieuGiao char(10),
	MaKh char(50),
	constraint pk_pgh primary key(MaPhieuGiao),
)
ALTER TABLE PHIEUGIAOHANG ADD CONSTRAINT FK_PGH_KH FOREIGN KEY(MaKh) REFERENCES KHACHHANG(MAKH)

CREATE TABLE CHITIETPHIEUGIAO
(
	MaPhieuGiao char(10),
	MaSP char(50),
	SoLuong int,
	MaNVGiao char(10),
	LanGiao int,
	DchiGiao nvarchar(50),
	constraint pk_ctgh primary key(MaPhieuGiao,LanGiao),
)
alter table CHITIETPHIEUGIAO ADD CONSTRAINT FK_CTPG_PG FOREIGN KEY(MaPhieuGiao) REFERENCES PHIEUGIAOHANG(MaPhieuGiao)
alter table CHITIETPHIEUGIAO ADD CONSTRAINT FK_CTPG_nv FOREIGN KEY(MaNVGiao) REFERENCES NHANVIEN(MANV)
alter table CHITIETPHIEUGIAO ADD CONSTRAINT FK_CTPG_SP FOREIGN KEY(MaSP) REFERENCES SANPHAM(MaSanPham)

INSERT INTO LOAISANPHAM
VALUES('TV',N'Tivi')
INSERT INTO LOAISANPHAM
VALUES('TL',N'Tủ lạnh')
INSERT INTO LOAISANPHAM
VALUES('MG',N'Máy giặt')
INSERT INTO LOAISANPHAM
VALUES('LT',N'Laptop')

INSERT INTO NHACUNGCAP
VALUES('SSVN',N'Sam Sung Việt Nam',N'123 Tây Thạnh, Tân Phú, HCM','0399933333')
INSERT INTO NHACUNGCAP
VALUES('PNSN',N'Panasonic',N'123 Võ Văn Ngân, Thủ Đức','0399933113')
INSERT INTO NHACUNGCAP
VALUES('SN',N'Sony',N'501 Nguyễn Thái Bình, Tân Bình, HCM','0399955567')


SELECT * FROM SANPHAM
INSERT INTO SANPHAM
VALUES('TV001',N'Tivi Sam Sung 47 inch','TV','SSVN',N'Cái',15000000)
INSERT INTO SANPHAM
VALUES('TV002',N'Tivi Sony 39 inch','TV','SN',N'Cái',14000000)
INSERT INTO SANPHAM
VALUES('TL001',N'Tủ lạnh Panasonic','TL','PNSN',N'Cái',10000000)
INSERT INTO SANPHAM
VALUES('TL002',N'Tủ lạnh Sony Cao cấp','TL','SN',N'Cái',25000000)

INSERT INTO SANPHAM
VALUES('MG001',N'Máy giặt Panasonic','MG','PNSN',N'Cái',16000000)
INSERT INTO SANPHAM
VALUES('MG002',N'Máy giặt Sam Sung','MG','SSVN',N'Cái',18000000)

INSERT INTO NHANVIEN
VALUES('NV01',N'Đinh Duy Nhất',convert(datetime,'18-12-00 10:34:09 PM',5),'0354486689',N'Đồng Nai')
SET DATEFORMAT DMY

select * from TAIKHOANTHANHVIEN where SOTHE=123

insert into CHITIETHD
values
('HD01','MG001',2,2000,4000,'2 tháng'),
('HD01','MG002',2,2000,4000,'3 tháng'),
('HD02','MG001',2,2000,4000,'2 tháng')

select * from KHACHHANG
where MAKH='0123456789'

select *from HOADON
where NGAYHD = GETDATE()

select GETDATE()

select *from SANPHAM
select *from CHITIETHD

select *from SANPHAM

INSERT INTO QUYENDN
VALUES('1','Admin')
INSERT INTO QUYENDN
VALUES('0','Nhân Viên')

INSERT INTO TAIKHOAN
VALUES('NV001','123',0)
INSERT INTO TAIKHOAN
VALUES('admin','123',1)

select *from KHACHHANG

